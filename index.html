<!-- HIT template: ImageTagging-v3.0 --><!-- Bootstrap v3.0.3 --><!-- Please note that Bootstrap CSS/JS and JQuery are 3rd party libraries that may update their url/code at any time. Amazon Mechanical Turk (MTurk) is including these libraries as a default option for you, but is not responsible for any changes to the external libraries -->
<link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" integrity="sha384-IS73LIqjtYesmURkDE9MXKbXqYA8rvKEp/ghicjem7Vc3mGRdQRptJSz60tvrB6+" rel="stylesheet" /><!-- The following snippet enables the 'responsive' behavior on smaller screens -->
<meta content="width=device-width,initial-scale=1" name="viewport" /><!-- Instructions -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<section class="container" id="TaggingOfAnImage">
<div class="row">
<div class="col-xs-12 col-md-12">&nbsp;</div>
<input name="thread_id" type="hidden" value="${thread_id}" />
<div class="row" id="workContent">
<!-- <div class="col-xs-12 col-md-12 col-lg-12" style="border: 4px solid rgb(140, 167, 190); border-image: none; background-color: rgb(208, 225, 244);">
<div class="holder" style="margin: 30px auto; width: 900px; height: 300px; overflow: auto;">
<div>
-->
<div class="help">
<input class="helpInput" type="submit" value="help">
<div>
  Session Count: <b class="count">0</b>
</div>
</div>
<div id="conversationvar">

<div class="nameinput">  
Name: <input class="fname" type="text" name="fname"><br>
<input class="start" type="submit" value="start">
</div>
----------------
<div class="reviewinput">  
Review: <input class="freview" type="text" name="freview"><br>
<input class="review" type="submit" value="review">
</div>




</div>
<!---
</div>
</div>
</div>
-->
<div class="static">
Submitted
</div>
<div class="col-xs-12 col-md-12 col-lg-12 text-center" style="margin-top: 30px;"><span style="font-size: 23px;"><strong>Task:</strong></span> <span style="font-size: 20px;">Scroll through the above conversation and determine what problems the pet is having.  Check all that apply:</span></div>

<div class="col-xs-12 col-md-12 col-lg-12" style="margin-top: 30px;">
<div class="col-xs-12 col-md-3 col-lg-3 padR0"><label><input class="chk1" name="Diarrhea" type="checkbox" value="Diarrhea" />Diarrhea</label></div>

<div class="col-xs-12 col-md-3 col-lg-3 padR0"><label><input class="chk1" name="Vomit" type="checkbox" value="Vomit" />Vomit</label></div>

<div class="col-xs-12 col-md-3 col-lg-3 padR0"><label><input class="chk1" name="Skin" type="checkbox" value="Skin" />Skin</label></div>

<div class="col-xs-12 col-md-3 col-lg-3"><label><input class="chk1" name="Cough" type="checkbox" value="Cough" />Cough</label></div>
</div>

<div class="col-xs-12 col-md-12 col-lg-12" style="margin-top: 15px;">
<div class="col-xs-12 col-md-3 col-lg-3 padR0"><label><input class="chk1" name="Urinary" type="checkbox" value="Urinary" />Urinary</label></div>

<div class="col-xs-12 col-md-3 col-lg-3 padR0"><label><input class="chk1" name="Eye" type="checkbox" value="Eye" />Eye</label></div>

<div class="col-xs-12 col-md-3 col-lg-3 padR0"><label><input class="chk1" name="Ear" type="checkbox" value="Ear" />Ear</label></div>

<div class="col-xs-12 col-md-3 col-lg-3"><label><input class="chk1" name="Dentistry" type="checkbox" value="Dentistry" />Dentistry</label></div>
</div>

<div class="col-xs-12 col-md-12 col-lg-12" style="margin-top: 15px;">
<div class="col-xs-12 col-md-3 col-lg-3 padR0"><label><input class="chk1" name="Lumps:Masses:Tumors" type="checkbox" value="Lumps, Masses, or Tumors" />Lumps, Masses, or Tumors</label></div>

<div class="col-xs-12 col-md-3 col-lg-3 padR0"><label><input class="chk1" name="Diet" type="checkbox" value="Diet" />Diet</label></div>

<div class="col-xs-12 col-md-3 col-lg-3 padR0"><label><input class="chk1" name="InjuriesWounds" type="checkbox" value="Injuries/Wounds" />Injuries/Wounds</label></div>

<div class="col-xs-12 col-md-3 col-lg-3"><label><input class="chk1" name="Vaccinations" type="checkbox" value="Vaccinations" />Vaccinations</label></div>
</div>

<div class="col-xs-12 col-md-12 col-lg-12" style="margin-top: 15px;">
<div class="col-xs-12 col-md-3 col-lg-3 padR0"><label><input class="chk1" name="Ticks" type="checkbox" value="Ticks" />Ticks</label></div>

<div class="col-xs-12 col-md-3 col-lg-3 padR0"><label><input class="chk1" name="Worms" type="checkbox" value="Worms" />Worms</label></div>

<div class="col-xs-12 col-md-3 col-lg-3 padR0"><label><input class="chk1" name="Fleas" type="checkbox" value="Fleas" />Fleas</label></div>

<div class="col-xs-12 col-md-3 col-lg-3"><label><input class="chk1" name="AteSomethingStrange" type="checkbox" value="Ate-Somthing Strange" />Ate-Something Strange</label></div>
</div>

<div class="col-xs-12 col-md-12 col-lg-12" style="margin-top: 15px; margin-bottom: 15px;">
<div class="col-xs-12 col-md-3 col-lg-3 col-md-push-3 col-lg-push-3 padR0"><label><input class="chk1" name="MentalDistress" type="checkbox" value="Mental Distress" />Mental Distress</label></div>

<div class="col-xs-12 col-md-3 col-lg-3 col-md-push-3 col-lg-push-3 padR0"><label><input class="chk1" name="Seizures" type="checkbox" value="Seizures" />Seizures</label></div>

<div class="col-xs-12 col-md-3 col-lg-3 col-md-push-3 col-lg-push-3 padR0"><label><input id="noneofthese" name="NoneOfTheseApply" type="checkbox" value="NONE OF THESE APPLY" />NONE OF THESE APPLY</label></div>
</div>
<div id="submitdiv">
<input class="submit" type="submit" value="submit"/>
<div class="loaderbutton" style="display:none"></div>
</div>
</section>
<!-- End Image Tagging Layout --><!-- Open internal style sheet -->
<style type="text/css">input[type="radio"], [type="checkbox"] {
 -ms-transform: scale(1.5); /* IE 9 */
 -webkit-transform: scale(1.5); /* Chrome, Safari, Opera */
 transform: scale(1.5);
 margin-right: 15px !important;
 }

 .btns {
 width: 100%;
 height: 85px;
 background-color: #67A1DD;
 color: #fff !important;
 border: 0px none;
 -webkit-box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.25);
 -moz-box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.25);
 box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.25);
 font-size: 20px;
 }

 .padR0 {
 padding-right: 0px !important;
 }

 .btns:hover {
 color: #fff !important;
 }

 .btns:focus {
 background-color: #008E00 !important;
 }

 .btnActive {
 background-color: #008E00 !important;
 }

 .btnprev {
 background-color: #EB8005;
 color: #000;
 border: 0px none;
 font-size: 17px;
 font-weight: bold;
 padding: 8px 15px;
 }

 .spanQCls {
 font-size: 23px;
 }

 .spanACls {
 font-size: 20px;
 margin-left: 5px;
 }

 .divCls {
 margin-top: 15px;
 }

 .flat-table {
   display: block;
     font-family: sans-serif;
       -webkit-font-smoothing: antialiased;
         font-size: 115%;
    overflow: auto;
      width: auto;
        border: 2px solid transparent !important;
          margin-left: auto;
     margin-right: auto;
     }

       tbody {
           border: 2px solid rgb(255,0,0) !important;
      }
   th {
       background-color: #107896;
    color: white;
        font-weight: bold;
     padding: 20px 30px;
         text-align: center;
      border: 2px solid rgb(0,0,0) !important;
          font-size: 100%;
    
      }
    td {
        background-color: rgb(238, 238, 238);
     color: black;
         padding: 20px 30px;
      border: 2px solid rgb(0,0,0) !important;
          text-align: center;
       font-size: 80%;
          font-weight: bold;
      }

 div.static {
     position: absolute;
         background: #61CB2B;
      top: 10px;
        left: 0; 
   right: 0; 
     margin-left: auto; 
       margin-right: auto;
      width: 200px;
           height: 60px;
      text-align: center;
            font-size: 30px;
      padding-top: 10px;
      padding-bottom: 10px;
         border-radius: 20px;
      display: none;
      }


 .container {
  padding-bottom: 30px;
   
 }

 .loader {
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid #3498db;
  width: 60px;
  height: 60px;
  -webkit-animation: spin 2s linear infinite; /* Safari */
  animation: spin 2s linear infinite;
}

 .loaderbutton {
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid #3498db;
  width: 60px;
  height: 60px;
  -webkit-animation: spin 2s linear infinite; /* Safari */
  animation: spin 2s linear infinite;
}



@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

.help {
  position: absolute;
    right: 30px;
    top: 20px;
}


.helpInput {
    background-color: #A91B0D;
    color: white;
}


 </style>
 <!-- Close internal style sheet --><!-- Please note that Bootstrap CSS/JS and JQuery are 3rd party libraries that may update their url/code at any time. Amazon Mechanical Turk (MTurk) is including these libraries as a default option for you, but is not responsible for any changes to the external libraries --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js" integrity="sha384-s1ITto93iSMDxlp/79qhWHi+LsIi9Gx6yL+cOKDuymvihkfol83TYbLbOw+W/wv4" crossorigin="anonymous"></script><script>

var form = false;
var user = "";
var convo_id = 0;
var API_url = 'https://omxz4u00t4.execute-api.us-east-1.amazonaws.com/prod/entries';
var checked_array = [];
var convo;


var loaderhtml = '<div class="loader"></div>';

function submit_convo(){
  checked_array = [];
  $("input:checkbox:checked").each(function(){
      checked_array.push($(this).val());
      });

  $(".loaderbutton").show();
  $(".submit").hide();
  $.ajax({
    type: "POST",
    url: API_url,
    success: function(data){
      $(".count").html(parseInt($(".count").html()) + 1);
      $(".loaderbutton").hide();
      document.getElementById("conversationvar").innerHTML = '';
      document.body.scrollTop = document.documentElement.scrollTop = 0;
      $(".static").show().fadeOut(2000);
      $('.chk1').prop('checked', false);
      $('#noneofthese').prop('checked', false);
      get_next_convo();
    },
      error: function(XMLHttpRequest, textStatus, errorThrown) {
         $(".submit").show();
         alert("Could not submit at this time.");
    },
    contentType: "application/json",
    data: JSON.stringify({"review": false, "convo_id": convo_id, "labeler": user, "labels": checked_array , "convo": convo})
  });

}

function get_next_convo(){
  $.getJSON(API_url, function(data, status){
    if (status == "success" && data.labels[0] != "DONE"){
      convo_id = data.convo_id;
      convo = data.convo
      document.getElementById("conversationvar").innerHTML = convo;
      $(".submit").show();
      $('.chk1').prop('checked', false);
      $('#noneofthese').prop('checked', false);

      form = true;
          } else {
      document.getElementById("conversationvar").innerHTML = 'No form available. <input class="start" type="submit" value="Request Form">';
    }
  });
}


function get_review_convo(){

    $.ajax({
    type: "POST",
    url: API_url,
    success: function(data){
      document.getElementById("conversationvar").innerHTML = data.convo;
      document.body.scrollTop = document.documentElement.scrollTop = 0;
      $('.chk1').prop('checked', false);
      $('#noneofthese').prop('checked', false);
      $("#submitdiv").html("Refresh the page to request new conversation.");
    },
      error: function(XMLHttpRequest, textStatus, errorThrown) {
        $(".submit").show();
     alert("Could not find convo with that id.");
    },
    contentType: "application/json",
    data: JSON.stringify({"review": true, "convo_id": convo_id})
  });


}



 $(document).ready(function () {

 $(".start").click(function (e) {
   user = $(".fname").val().replace(/\s/g,'').toLowerCase();
   if (user == ""){
     alert("No name entered");
   } else {
     document.getElementById("conversationvar").innerHTML = loaderhtml; 
     get_next_convo();  
   }
   return false;
 });

 $(".review").click(function (e) {
   convo_id = $(".freview").val()
   if (convo_id == ""){
     alert("No review entered");
   } else {
     document.getElementById("conversationvar").innerHTML = loaderhtml; 
     get_review_convo();  
   }
 });



 $(".help").click(function () {
    window.open('./vetinstructions.pdf','_blank');
 });

 $(".submit").click(function (e) {
   if (!form){
     alert("No form to submit") ;
   } else if ($(":checkbox:checked").length == 0){
     alert("Please check some boxes"); 
   } else {
     form = false;
     submit_convo();
   }


  return false;
    
 });
 
 $("#noneofthese").click(function (e) {
 
 $('.chk1').prop('checked', false);
 });

 $(".chk1").click(function (e) {

 $('#noneofthese').prop('checked', false);
 });

 $(".btns").click(function (e) {
 $(this).addClass("btnActive");
 var btnval = $(this).val();
 //alert(btnval);
 });



 });

 </script>


